<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      #displayContainer {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Search By Names</h1>
    <input type="text" id="name-input" />
    <div id="displayContainer"></div>
  </body>
  
</html>
<script>
  let container = document.getElementById("displayContainer");
  let inputSearch = document.getElementById("name-input");

  let pokemons;

  let timer;
  inputSearch.addEventListener("input", (e) => {
    let inputValue = e.target.value.toLowerCase();

    if (inputValue === "") {
      container.innerHTML = "";
      return;
    }

    let filterByName = pokemons.filter((ele) =>
      ele.name.toLowerCase().includes(inputValue)
    );

    clearTimeout(timer);
    timer = setTimeout(() => {
      console.log("api called");
      displayData(filterByName);
    }, 1000);
  });
  
 let imagesData=[];

 async function fetchImages(url) {
  let response2=  await fetch(url);
    let data2= await response2.json();
    let image= data2.sprites.back_default ||
    data2.sprites.front_default ||'';
      return image;
 }
  async function fetchData() {
    let respone = await fetch("https://pokeapi.co/api/v2/pokemon?limit=100");
    let data = await respone.json();
    pokemons = data.results;
   
   for(let pokemon of pokemons){
      let image= await fetchImages(pokemon.url)
     if(image){
      imagesData.push({
        ...pokemon,
        image:image
      })
     }

   }
  // console.log(imagesData)
  displayData() ;
    
  }
  fetchData();

  function displayData() {
    container.innerHTML = "";

    imagesData.length === 0
      ? (container.innerHTML = `<p>Not found</P`)
      : imagesData.forEach((pokemon) => {
          let pokemonCard = document.createElement("div");
          pokemonCard.className = "pokemon-card";
          pokemonCard.setAttribute("data-url", pokemon.url);
    
         pokemonCard.innerHTML = `
        <h3>${pokemon.name}</h3>
        <img src=${pokemon.image} />
        `;

          container.appendChild(pokemonCard);
          }
        );
  }

  container.addEventListener("click", async (e) => {
    let currentCard = e.target.closest(".pokemon-card");

    if (currentCard) {
      let getUrl = currentCard.getAttribute("data-url");
      if (getUrl) {
        let respone = await fetch(getUrl);
        let data = await respone.json();
        container.innerHTML = '';
        alert("data logged in console");
        console.log(data)
      }
    }
  });

</script>
